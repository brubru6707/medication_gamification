<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Gemini API Test</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
        }
        .test-result {
            background: #2d2d2d;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #00ff00;
        }
        .error {
            border-left-color: #ff0000;
            color: #ff6b6b;
        }
        .warning {
            border-left-color: #ffa500;
            color: #ffcc00;
        }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #00cc00;
        }
        pre {
            background: #000;
            padding: 10px;
            overflow-x: auto;
            border: 1px solid #00ff00;
        }
    </style>
</head>
<body>
    <h1>üîß Gemini API Diagnostic Tool</h1>
    <p>This will test your API key and check which models are available.</p>
    
    <button onclick="testAPIKey()">1. Test API Key</button>
    <button onclick="testTextGeneration()">2. Test Text Generation</button>
    <button onclick="testImageGeneration()">3. Test Image Generation</button>
    <button onclick="listModels()">4. List Available Models</button>
    
    <div id="results"></div>

    <script src="gemini-config.js"></script>
    <script>
        const resultsDiv = document.getElementById('results');

        function addResult(title, content, type = 'success') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${title}</strong><br>${content}`;
            resultsDiv.appendChild(div);
        }

        async function testAPIKey() {
            resultsDiv.innerHTML = '';
            addResult('Testing API Key...', 'Checking if your API key is valid...', 'warning');
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${GEMINI_API_KEY}`);
                const data = await response.json();
                
                if (response.status === 200) {
                    addResult('‚úÖ API Key Valid!', `Your API key is working correctly.<br>Status: ${response.status}`);
                } else if (response.status === 429) {
                    addResult('‚ö†Ô∏è Rate Limit!', 'API key is valid but you hit the rate limit. Wait 60 seconds.', 'warning');
                } else {
                    addResult('‚ùå API Key Error', `Status: ${response.status}<br>Error: ${JSON.stringify(data)}`, 'error');
                }
            } catch (error) {
                addResult('‚ùå Connection Error', error.message, 'error');
            }
        }

        async function testTextGeneration() {
            addResult('Testing Text Generation...', 'Trying gemini-pro model...', 'warning');
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: 'Say hello!' }]
                        }]
                    })
                });
                
                const data = await response.json();
                
                if (response.status === 200 && data.candidates) {
                    const text = data.candidates[0].content.parts[0].text;
                    addResult('‚úÖ Text Generation Works!', `Response: "${text}"`);
                } else if (response.status === 429) {
                    addResult('‚ö†Ô∏è Rate Limit!', 'Wait 60 seconds and try again.', 'warning');
                } else {
                    addResult('‚ùå Text Generation Failed', `<pre>${JSON.stringify(data, null, 2)}</pre>`, 'error');
                }
            } catch (error) {
                addResult('‚ùå Error', error.message, 'error');
            }
        }

        async function testImageGeneration() {
            addResult('Testing Image Generation...', `Trying ${GEMINI_IMAGE_MODEL} model...`, 'warning');
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_IMAGE_MODEL}:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: 'Create a simple red circle' }]
                        }]
                    })
                });
                
                const data = await response.json();
                
                console.log('Image generation response:', data);
                
                if (response.status === 200) {
                    // Check what we got back
                    if (data.candidates && data.candidates[0]) {
                        const parts = data.candidates[0].content.parts;
                        const hasImage = parts.some(p => p.inlineData);
                        const hasText = parts.some(p => p.text);
                        
                        if (hasImage) {
                            addResult('‚úÖ Image Generation Works!', 'The model successfully generated an image!');
                        } else if (hasText) {
                            addResult('‚ö†Ô∏è Text Instead of Image', `The model returned text instead of an image. It might not support image generation yet.<br><br>Response: ${parts[0].text}`, 'warning');
                        } else {
                            addResult('‚ö†Ô∏è Unknown Response', `<pre>${JSON.stringify(data, null, 2)}</pre>`, 'warning');
                        }
                    }
                } else if (response.status === 429) {
                    addResult('‚ö†Ô∏è Rate Limit!', 'Wait 60 seconds and try again.', 'warning');
                } else if (response.status === 404) {
                    addResult('‚ùå Model Not Found', `The model "${GEMINI_IMAGE_MODEL}" doesn't exist or isn't available to you yet.<br><br>Try using text generation to create descriptions instead!`, 'error');
                } else {
                    addResult('‚ùå Image Generation Failed', `Status: ${response.status}<br><pre>${JSON.stringify(data, null, 2)}</pre>`, 'error');
                }
            } catch (error) {
                addResult('‚ùå Error', error.message, 'error');
            }
        }

        async function listModels() {
            addResult('Listing Available Models...', 'Fetching model list...', 'warning');
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${GEMINI_API_KEY}`);
                const data = await response.json();
                
                if (response.status === 200 && data.models) {
                    const modelList = data.models
                        .map(m => `‚Ä¢ ${m.name} - ${m.displayName}`)
                        .join('<br>');
                    
                    const imageModels = data.models.filter(m => 
                        m.name.includes('image') || 
                        m.displayName.toLowerCase().includes('image') ||
                        m.displayName.toLowerCase().includes('imagen')
                    );
                    
                    addResult('‚úÖ Available Models', 
                        `Found ${data.models.length} models:<br><br>${modelList}<br><br>` +
                        `Image-related models: ${imageModels.length > 0 ? imageModels.map(m => m.displayName).join(', ') : 'None found'}`, 
                        imageModels.length > 0 ? 'success' : 'warning'
                    );
                } else if (response.status === 429) {
                    addResult('‚ö†Ô∏è Rate Limit!', 'Wait 60 seconds and try again.', 'warning');
                } else {
                    addResult('‚ùå Failed to List Models', `<pre>${JSON.stringify(data, null, 2)}</pre>`, 'error');
                }
            } catch (error) {
                addResult('‚ùå Error', error.message, 'error');
            }
        }

        // Auto-run API key test on load
        window.addEventListener('load', () => {
            setTimeout(testAPIKey, 500);
        });
    </script>
</body>
</html>
